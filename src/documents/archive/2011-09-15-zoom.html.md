---
title: Артефакты масштабирования
author: Роман Комаров
tags: [CSS, вёрстка, мобильные технологии]
---

Несколько лет назад считалось хорошим тоном учитывать в вёрстке ±2 шага масштабирования текста, то есть многие вещи надо было верстать, используя относительные единицы `em`. Но сейчас в игру вступило полностраничное масштабирование документов, практически вытеснив масштабирование текста.

Почти все современные браузеры по умолчанию масштабируют весь документ (опция по изменению только размера шрифта осталась, но используется всё реже). Кроме того, мобильные устройства распространяются всё шире, а на них полностраничное масштабирование используется постоянно — это один из основных способов взаимодействия со страницами.

Однако при реализации полностраничного масштабирования существует довольно много проблем. Большинство из них связано с появлением различных графических артефактов, возникающих из-за особенностей округления при рендеринге отмасштабированных блоков. В этой статье мы рассмотрим несколько подобных артефактов и расскажем, как их устранить.

## Проблемы с кадрированием спрайтов[<sup>пример</sup>][3]

Спрайты основательно вошли в арсенал современного верстальщика, оказавшись удобным способом предзагрузки изображений и избавления от лишних запросов. Но не все учитывают, что практически в любом браузере при масштабировании страницы есть проблемы с отображением перехода от одного кадра спрайта к другому.

Основная проблема — при увеличении масштаба по краям блоков начинают просвечивать части других кадров.

![Сравнительная таблица масштабирования в разных браузерах][1]

Эта проблема возникает во всех современных десктопных браузерах при увеличении страницы зумом, исключение — Firefox. Исправляется она довольно очевидным способом (хотя его применение для уже готовых больших спрайтов может и отнять какое-то время). Достаточно добавить между кадрами спрайта однопиксельные отступы, прозрачные для `png` или `gif` и цвета предполагаемого фона для `jpg`. И при изменении масштаба теперь будут просвечивать именно эти прозрачные пиксели.

![Исправленные кадры спрайта при масштабировании][2]

В iOS те же проблемы возникают даже при уменьшении масштаба, при этом исправление через отступы может чуть больше замыливать результат. Но в iOS есть и второй способ исправления — нужно применить к блоку с кадром спрайта магический хак `-webkit-transform: translateZ(0)`, который включает аппаратное ускорение рендеринга. А в сочетании с исправлением промежутком кадры масштабируются практически идеально.

![Варианты исправлений для iPhone 4][5]


## Проблемы при позиционировании блоков[<sup>пример</sup>][4]

Аналогичные проблемы могут возникать и в вёрстке без картинок. Например, если нам надо расставить блоки так, чтобы из нескольких прямоугольников получалась цельная фигура. 

Такие проблемы могут проявляться редко, обычно в каких-то сложных условиях. Например, в Firefox, при абсолютном позиционировании блока с использованием свойства `clip`, или в браузерах на движке webkit при вёрстке с использованием плавающих блоков. 

Во всех случаях лучший метод исправления — перевёрстка. В случае с плавающими блоками надо экспериментировать с комбинациями относительного позиционирования и сдвигов через `margin`.

Например, если у нас есть такие блоки:

    .b-block {
        padding: 1em;
        }
        .b-block__inner {
            float: right;

            width:4em;
            height:3em;
            margin: -1em -5em 0 0;
            }

Исправление для внутреннего блока будет таким:

    .b-block__inner {
        position: relative;
        left: 4em;

        float: right;

        width:4em;
        height:3em;

        margin: -1em -1em 0 -4em;
        }

Здесь мы сначала компенсируем `padding` у родителя при помощи `margin`, а потом дополнительно смещаем блок позиционированием.

Кстати, для iOS эти проблемы также можно исправить через включение аппаратного ускорения рендеринга, при этом исправление через перевёрстку не всегда будут срабатывать. Итого, лучше всего использовать оба варианта — так мы добьёмся работоспособности блока везде.

Пример бага в webkit при вёрстке с использованием плавающих блоков можно увидеть на [этой странице][4] (не забудьте менять масштаб).

[1]: http://img-fotki.yandex.ru/get/4518/1076905.1/0_65357_198b451a_orig
[2]: http://img-fotki.yandex.ru/get/4813/1076905.1/0_65358_8452d5d3_orig
[3]: http://yandex-ui.github.com/Examples/zooming/
[4]: http://yandex-ui.github.com/Examples/zooming/blocks/
[5]: http://img-fotki.yandex.ru/get/5014/1076905.1/0_65369_4a99af45_orig
