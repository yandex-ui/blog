<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7,IE=edge"><meta name="viewport" content="width=device-width"><meta name="generator" content="DocPad v6.65.0" /><link  rel="stylesheet" href="/blog/style.css" /></head><body><div class="page"><h1 class="page-head">Архив клуба разработки интерфейсов</h1><div class="page-content"><header><h1>Немного про сглаживание</h1><p>Опубликовано Thu Jul 24 2014 15:09:50 GMT+0400 (MSK). Автор: Роман Комаров.</p></header><p><img src="http://img-fotki.yandex.ru/get/4412/1076905.1/0_67bc8_94214aef_orig" alt="Варианты сглаживания текста"></p>
<p>У браузеров на основе движка webkit можно управлять сглаживанием текста через свойство <code>-webkit-font-smoothing</code>. У этого свойства бывает три возможных значения: <code>subpixel-antialiased</code>, субпиксельное сглаживание, <code>antialiased</code>, простое сглаживание, и none, совсем отключающее сглаживание.</p>
<p>Для десктопных систем по умолчанию применяется субпиксельное сглаживание. Напротив, в мобильных платформах, например в iOS, используется обычное сглаживание, а субпиксельное нельзя включить, даже явно его задав.</p>
<p>В большинстве случаев вам не придётся изменять значение этого свойства, однако существует несколько случаев, когда это может быть необходимо. Кроме того, бывают случаи, когда надо исправлять сглаживание не для текста, а для блоков, к которым применяются какие-либо CSS-трансформации. Обо всём этом мы и расскажем в этой статье.</p>
<h2 id="-sup-sup-2-">Потеря сглаживания из-за аппаратного ускорения или внешних объектов<a href="http://yandex-ui.github.com/Examples/aliasing/"><sup>пример</sup></a></h2>
<p>В webkit существует одна особенность (или баг), из-за которого могут возникать ситуации, когда текст на десктопе теряет субпиксельное сглаживание. Чаще всего это может произойти по одной из следующих причин:</p>
<ul>
<li>Рядом или внутри блока находится флэш-объект, <code>iframe</code> или какой-то иной внешний объект.</li>
<li>Рядом или внутри блока может находиться блок с применённым к нему аппаратным ускорением (например, через упомянутый в <a href="../zoom/">прошлом посте</a> <code>-webkit-transform: translateZ(0)</code>).</li>
</ul>
<p>В таких случаях можно будет заметить (особенно хорошо это может быть видно, если такой объект появляется динамически), что у текста «потерялось» субпиксельное сглаживание.</p>
<p>Скорее всего, это происходит из-за природы такого сглаживания. Для его рендеринга необходимо знать фон под текстом; когда же мы добавляем флеш или насильно включаем аппаратное ускорение, то и текст переносится в слой с ним. Если фон там не задан явно, то браузер не может его взять и меняет тип сглаживания. Таким образом, одним из решений будет найти блок, в котором применяется аппаратное ускорение, и задать ему или его детям явный фон. Однако в более новых версиях движка webkit этого может быть недостаточно: там сглаживание не просто не отрабатывает, а явно сбрасывается на значение <code>antialiased</code>, то есть необходимо его восстановить вручную.</p>
<p>Итак, для исправления потерянного сглаживания в большинстве случаев достаточно будет применить следующий код, заменив цвет фона на тот, что нужен:</p>
<pre><code>.block {
    background: #FFF;
    -webkit-font-smoothing: subpixel-antialiased;
    }
</code></pre><p>Посмотреть на потерянное сглаживание и его исправление можно на <a href="http://yandex-ui.github.com/Examples/aliasing/">этой тестовой странице</a>.</p>
<h2 id="-sup-sup-3-">Отключение субпиксельного сглаживания для улучшения отображения<a href="http://yandex-ui.github.com/Examples/aliasing/no-subpixels/"><sup>пример</sup></a></h2>
<h3 id="-">Тёмный фон, светлый текст</h3>
<p><img src="http://img-fotki.yandex.ru/get/4612/1076905.1/0_67bca_b6091016_orig" alt="Светлый текст на тёмном фоне и серый текст на цветном фоне"></p>
<p>Достаточно известный момент, но его стоит упомянуть в этой статье: субпиксельное сглаживание устроено так, что светлые буквы на тёмном фоне будут выглядеть «жирнее», чем наоборот. Иногда подобное отображение может быть некрасивым, в таком случае для браузеров на движке webkit это можно легко исправить применив к нужному блоку <code>-webkit-font-smoothing: antialiased</code>, обычное сглаживание сделает текст тоньше.</p>
<h3 id="-">Менее яркий текст</h3>
<p>Часто может возникнуть необходимость в «сером» тексте: менее ярком и не бросающемся в глаза. Обычно его делают просто: задают явно серый цвет, например <code>#808080</code>. Однако в некоторых случаях это не идеальный вариант: скажем, на цветном фоне серый текст будет выглядеть не очень хорошо (а серый на сером — и вовсе неразличим). Иногда можно встретить решение этой задачи через задание <code>opacity: 0.5</code> для блока с текстом, но при изменении <code>opacity</code> большинство браузеров не учитывает субпиксельное сглаживание, и текст может выглядеть плохо. В таком случае лучше задать цвет через <code>rgba:</code> <code>color: rgba(0,0,0,0.5)</code> — для цветов, заданных в таком виде, субпиксельное сглаживание срабатывает нормально.</p>
<p>Если же вам в любом случае надо применять <code>opacity</code> к блоку, то иногда будет лучше поменять сглаживание на <code>antialisased</code>, чтобы избежать проблем с субпиксельным сглаживанием.
Посмотрите на <a href="http://yandex-ui.github.com/Examples/aliasing/no-subpixels/">пример с различными вариантами вёрстки неяркого текста</a>.</p>
<h2 id="-sup-sup-4-">Сглаживание блоков, подверженных трансформациям<a href="http://yandex-ui.github.com/Examples/aliasing/rotate/"><sup>пример</sup></a></h2>
<p><img src="http://img-fotki.yandex.ru/get/4708/1076905.1/0_67bc7_9f0380ef_orig" alt="«Лесенка» при повороте блока"></p>
<p>Кроме сглаживания текста, в современной вёрстке может встретиться и сглаживание краёв блоков или изображений. Есть несколько ситуаций, когда такое сглаживание не будет идеальным.</p>
<p>Например, если применять всё в том же webkit различные трансформации к какому-либо блоку или изображению (например, вращение), то края у такого блока могут оказаться не сглаженными, а «лесенкой».</p>
<p>Для десктопного webkit это исправляется включением аппаратного ускорения для блока добавлением <code>translateZ(0)</code> в свойство трансформации. Не забудьте, что его надо добавлять только в свойство с префиксом <code>-webkit-</code>, так как трёхмерные трансформации не поддерживаются столь широко.</p>
<p>Для вращения блока код в итоге будет такой:</p>
<pre><code>.rotate {
    -webkit-transform: rotate(42deg) translateZ(0);
       -moz-transform: rotate(42deg);
         -o-transform: rotate(42deg);
            transform: rotate(42deg);
    }
</code></pre><p>Однако для мобильных версий webkit этого будет недостаточно: «лесенка» всё равно будет появляться. Поправить это можно «хаком»: добавить блоку прозрачную тень с радиусом в два пикселя (одного не всегда может быть достаточно): <code>-webkit-box-shadow: 0 0 2px rgba(0,0,0,0)</code> — подобным образом мы распространяем рендеринг блока на пару лишних пикселей, и сглаживание волшебным образом появляется.</p>
<h2 id="-">Сглаживание текста при трансформации</h2>
<p><img src="http://img-fotki.yandex.ru/get/4708/1076905.1/0_67bcb_9c3ad79f_orig" alt="Плохое сглаживание повёрнутого текста в webkit"></p>
<p>Хотя простые CSS-трансфомации поддерживаются современными браузерами достаточно хорошо, всё ещё остаётся несколько нюансов, с которыми надо считаться.</p>
<p>В Опере после применения трансформаций «слетает» сглаживание шрифтов, это лучше всего можно заметить, если сначала повернуть блок на 90 градусов, а потом внутренний блок развернуть обратно:</p>
<p><img src="http://img-fotki.yandex.ru/get/5411/1076905.1/0_67bc6_88eabc29_orig" alt="Пример плохого сглаживания текста в Опере"></p>
<p>А в браузерах на движке webkit при повороте блоков с субпиксельным сглаживанием будут повёрнуты и цветные пиксели, в итоге получится «размыленный» блок, который будет плохо читаться. Так что и в этом случае лучше вручную сбросить сглаживание на обычное через <code>-webkit-font-smoothing: antialiased</code>. А вот Firefox в данном случае работает отлично: он оставляет субпиксельное сглаживание и рисует цветные пиксели где нужно.</p>
</div></div><!-- Yandex.Metrika counter --><div style="display:none;"><script type="text/javascript">(function(w, c) { (w[c] = w[c] || []).push(function() { try { w.yaCounter8530063 = new Ya.Metrika({id:8530063, enableAll: true}); } catch(e) { } }); })(window, "yandex_metrika_callbacks");</script></div><script src="//mc.yandex.ru/metrika/watch.js" type="text/javascript" defer="defer"></script><noscript><div><img src="//mc.yandex.ru/watch/8530063" style="position:absolute; left:-9999px;" alt="" /></div></noscript><!-- /Yandex.Metrika counter --></body></html>